---
phase: 03-editor-experience
plan: 02
type: execute
wave: 2
depends_on:
  - "03-01"
files_modified: []
autonomous: false
requirements:
  - FIND-01
  - FIND-02
  - FIND-03
  - GIT-01
  - GIT-02
  - TREE-01
  - TREE-02

must_haves:
  truths:
    - "<leader>ff opens fzf-lua file picker in a centered floating window with preview on the right"
    - "<leader>fg opens fzf-lua live grep powered by ripgrep"
    - "<leader>fb opens fzf-lua buffer list"
    - "<leader>fc opens fzf-lua keymaps picker showing all available keymaps"
    - "Git-modified, added, and deleted lines show gutter signs immediately on opening a file in a git repo"
    - "]h and [h navigate between git hunks forward and backward"
    - "<leader>e toggles the file tree open and closed, tree is closed by default"
  artifacts:
    - path: "dotfiles/nvim/lua/plugins/fzf-lua.lua"
      provides: "Working fzf-lua plugin"
    - path: "dotfiles/nvim/lua/plugins/gitsigns.lua"
      provides: "Working gitsigns plugin"
    - path: "dotfiles/nvim/lua/plugins/neo-tree.lua"
      provides: "Working neo-tree plugin"
  key_links:
    - from: "lazy.nvim plugin scan"
      to: "fzf-lua.lua, gitsigns.lua, neo-tree.lua"
      via: "lua/plugins/ auto-scan"
      pattern: "require.*plugins"
    - from: "nix system rebuild"
      to: "neovim config symlink"
      via: "home-manager dotfile symlink"
      pattern: "xdg.configFile"
---

<objective>
Rebuild the Nix system and verify all three Phase 3 plugins work end-to-end in a live Neovim session.

Purpose: Plugin specs are just configuration — they must be verified in a running editor after a system rebuild to confirm lazy.nvim installs the plugins and all keybinds work correctly.
Output: Confirmed working fzf-lua, gitsigns, and neo-tree with all specified keybinds.
</objective>

<execution_context>
@/Users/sgoodluck/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sgoodluck/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-editor-experience/03-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: System rebuild and plugin sync</name>
  <files></files>
  <action>
Run the system rebuild and lazy.nvim plugin sync in sequence:

1. Run `nxr` (alias for `darwin-rebuild switch --flake ~/nix#sgoodluck-m1air`) to rebuild the Nix system
2. After rebuild succeeds, run `nvim --headless "+Lazy! sync" +qa` to install new plugins (fzf-lua, gitsigns, neo-tree, and their dependencies: plenary, nui, nvim-web-devicons)
3. Verify plugin installation by running: `nvim --headless -c "lua print(package.loaded['fzf-lua'] and 'loaded' or 'lazy')" -c "qa"` — fzf-lua should show "lazy" (not loaded until key trigger)
4. Measure cold start time: `nvim --startuptime /tmp/nvim-startup.log --headless +qa && tail -1 /tmp/nvim-startup.log` — should remain under 100ms since all three plugins are lazy-loaded

If rebuild fails due to a Nix evaluation error, check for syntax issues in the plugin files from Plan 01. The three new plugin files are pure Lua — Nix only needs to symlink the dotfiles directory.
  </action>
  <verify>
    <automated>nvim --headless "+Lazy! sync" +qa 2>&1 | tail -5 && nvim --startuptime /tmp/nvim-startup.log --headless +qa && tail -1 /tmp/nvim-startup.log</automated>
  </verify>
  <done>System rebuilt, lazy.nvim synced with all three new plugins installed, cold start still under 100ms</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: End-to-end verification of all Phase 3 plugins</name>
  <what-built>fzf-lua (fuzzy finder), gitsigns (git gutter), and neo-tree (file tree) plugin configurations</what-built>
  <how-to-verify>
Open Neovim in the nix repo (`cd ~/nix && nvim .`):

**fzf-lua (FIND-01, FIND-02, FIND-03):**
1. Press `<leader>ff` — file picker should open in a centered floating window with preview pane on the right
2. Type a filename to filter, press Enter to open — file should open in the editor
3. Press `<leader>fg` — live grep should open, type a search term, results update in real-time
4. Press `<leader>fb` — buffer list should show open buffers
5. Press `<leader>fc` — keymaps picker should show all available keymaps with descriptions (command palette)

**gitsigns (GIT-01, GIT-02):**
6. Open a file in the git repo — gutter signs should appear for any modified/added/deleted lines
7. Make a small edit to see `~` signs appear for modified lines
8. Press `]h` to jump to the next hunk, `[h` to jump to the previous hunk
9. Press `<leader>gp` to preview the current hunk diff

**neo-tree (TREE-01, TREE-02):**
10. Press `<leader>e` — file tree should open on the left side (30 chars wide)
11. Navigate the tree, press Enter to open a file — file opens in the editor, tree stays open
12. Press `<leader>e` again — tree should close (toggle behavior)
13. Confirm tree shows git status indicators (icons next to modified files)

**Cleanup:**
14. Press `-` — should NOT open netrw (the old bind is removed)
15. Run `:checkhealth gitsigns` — should show no errors
  </how-to-verify>
  <resume-signal>Type "approved" if all checks pass, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
1. System rebuild completes without errors
2. lazy.nvim installs fzf-lua, gitsigns, neo-tree, plenary, nui, nvim-web-devicons
3. Cold start remains under 100ms (all plugins lazy-loaded)
4. All 4 fzf-lua keybinds open their respective pickers
5. Gitsigns shows signs in gutter for git-tracked files with changes
6. Hunk navigation (`]h`/`[h`) works
7. Neo-tree toggles open/closed with `<leader>e`
8. Neo-tree shows on left side, 30 chars wide, filesystem source only
9. Old netrw `-` bind no longer works
</verification>

<success_criteria>
- All Phase 3 success criteria from ROADMAP.md verified:
  1. `<leader>ff`, `<leader>fg`, `<leader>fb` open file picker, live grep, and buffer list via fzf-lua
  2. `<leader>fc` opens a command palette showing all keymaps
  3. Git-modified/added/deleted lines show as gutter signs immediately on opening a file in a git repo
  4. `]h`/`[h` navigate between git hunks
  5. `<leader>e` toggles file tree open/closed, tree closed by default
- Cold start remains under 100ms
</success_criteria>

<output>
After completion, create `.planning/phases/03-editor-experience/03-02-SUMMARY.md`
</output>
