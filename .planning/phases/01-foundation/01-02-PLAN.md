---
phase: 01-foundation
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - dotfiles/nvim/init.lua
  - dotfiles/nvim/lua/config/options.lua
  - dotfiles/nvim/lua/config/keymaps.lua
  - dotfiles/nvim/lua/config/autocmds.lua
  - dotfiles/nvim/lua/plugins/colorscheme.lua
  - dotfiles/nvim/lua/plugins/treesitter.lua
autonomous: true
requirements:
  - FNDN-01
  - FNDN-02
  - FNDN-03
  - FNDN-04

must_haves:
  truths:
    - "Neovim opens to modus_vivendi_tinted colorscheme with bg_main overridden to #1d2235"
    - "init.lua is a thin bootstrap with no plugin config, no options lists, no colorscheme code"
    - "Options, keymaps, and autocmds live in lua/config/ with no plugin dependencies"
    - "Treesitter loads on BufReadPre with all 12 parsers in ensure_installed"
    - "fzf.vim, telescope, plenary, and commander are removed from the lazy spec"
  artifacts:
    - path: "dotfiles/nvim/init.lua"
      provides: "Thin bootstrap: leader, config/, lazy bootstrap, lazy.setup(plugins)"
      max_lines: 25
    - path: "dotfiles/nvim/lua/config/options.lua"
      provides: "All vim.opt.* settings"
    - path: "dotfiles/nvim/lua/config/keymaps.lua"
      provides: "Non-plugin keymaps with desc fields"
    - path: "dotfiles/nvim/lua/config/autocmds.lua"
      provides: "Minimal high-value autocmds"
    - path: "dotfiles/nvim/lua/plugins/colorscheme.lua"
      provides: "modus-themes.nvim eager-load spec with on_colors override"
      contains: "modus_vivendi_tinted"
    - path: "dotfiles/nvim/lua/plugins/treesitter.lua"
      provides: "nvim-treesitter master branch spec with 12 parsers"
      contains: "branch = \"master\""
  key_links:
    - from: "dotfiles/nvim/init.lua"
      to: "dotfiles/nvim/lua/config/"
      via: "require(\"config.options\"), require(\"config.keymaps\"), require(\"config.autocmds\")"
      pattern: "require.*config\\."
    - from: "dotfiles/nvim/init.lua"
      to: "dotfiles/nvim/lua/plugins/"
      via: "require(\"lazy\").setup(\"plugins\", {...})"
      pattern: "lazy.*setup.*plugins"
    - from: "dotfiles/nvim/lua/plugins/colorscheme.lua"
      to: "modus-themes.nvim"
      via: "vim.cmd(\"colorscheme modus_vivendi_tinted\")"
      pattern: "colorscheme modus_vivendi_tinted"
---

<objective>
Migrate the monolithic init.lua to a modular lua/ directory structure. Replace the hand-rolled colorscheme with modus-themes.nvim. Install nvim-treesitter with all 12 parsers. Remove fzf.vim, telescope, plenary, and commander.

Purpose: FNDN-01 through FNDN-04. The module structure is the foundation everything else in phases 2 and 3 builds on. The colorscheme and treesitter are the only two plugins this phase installs.
Output: A working modular Neovim config that opens cleanly with modus_vivendi_tinted and treesitter-highlighted syntax.
</objective>

<execution_context>
@/Users/sgoodluck/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sgoodluck/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@dotfiles/nvim/init.lua
@.planning/phases/01-foundation/01-CONTEXT.md
@.planning/phases/01-foundation/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create lua/config/ modules from existing init.lua</name>
  <files>
    dotfiles/nvim/lua/config/options.lua
    dotfiles/nvim/lua/config/keymaps.lua
    dotfiles/nvim/lua/config/autocmds.lua
  </files>
  <action>
    Create the `dotfiles/nvim/lua/config/` directory and three files. All content is migrated from the current init.lua — no logic changes, just extraction.

    **dotfiles/nvim/lua/config/options.lua**
    Move all `vim.opt.*` lines from init.lua verbatim. That is lines 7–24 of the current init.lua. No additions, no removals.

    **dotfiles/nvim/lua/config/keymaps.lua**
    Move all `vim.keymap.set(...)` lines from init.lua. That is:
    - Lines 27–29: leader binds (`<leader>w`, `<leader>q`, `<leader>h`)
    - Lines 32–35: window navigation (`C-hjkl`)
    - Lines 38–39: visual indenting (`</>/gv`)
    - Line 153: `"-"` for netrw/Ex

    Add `{ desc = "..." }` to any keymap missing a desc. Specifically add descriptors to the window nav and indenting maps (they lack them in the current init.lua). Use these exact strings:
    - `<C-h>`: `"Window left"`
    - `<C-j>`: `"Window down"`
    - `<C-k>`: `"Window up"`
    - `<C-l>`: `"Window right"`
    - `<`: `"Indent left"`
    - `>`: `"Indent right"`
    - `-`: `"File explorer (netrw)"`

    **dotfiles/nvim/lua/config/autocmds.lua**
    The current init.lua has no autocmds. Create the file with exactly two autocmds:

    1. Highlight on yank — visual feedback when yanking text:
    ```lua
    vim.api.nvim_create_autocmd("TextYankPost", {
      desc = "Highlight yanked text",
      group = vim.api.nvim_create_augroup("highlight_yank", { clear = true }),
      callback = function()
        vim.highlight.on_yank({ higroup = "Visual", timeout = 150 })
      end,
    })
    ```

    2. Remove trailing whitespace on save (skip markdown — intentional trailing spaces):
    ```lua
    vim.api.nvim_create_autocmd("BufWritePre", {
      desc = "Remove trailing whitespace on save",
      group = vim.api.nvim_create_augroup("trim_whitespace", { clear = true }),
      pattern = "*",
      callback = function()
        if vim.bo.filetype ~= "markdown" then
          local save_cursor = vim.fn.getpos(".")
          vim.cmd([[%s/\s\+$//e]])
          vim.fn.setpos(".", save_cursor)
        end
      end,
    })
    ```

    Do NOT add any other autocmds. These two are high-value and have no surprises.

    CRITICAL: None of these three files may call `require()` on any plugin. They load before lazy.nvim runs.
  </action>
  <verify>
    ```bash
    ls /Users/sgoodluck/nix/dotfiles/nvim/lua/config/
    ```
    Must show: `options.lua  keymaps.lua  autocmds.lua`

    ```bash
    grep -n "require(" /Users/sgoodluck/nix/dotfiles/nvim/lua/config/*.lua
    ```
    Must return no matches (no plugin requires in config files).
  </verify>
  <done>Three files exist in lua/config/ containing migrated options, keymaps with desc fields, and two autocmds. No plugin requires in any config file.</done>
</task>

<task type="auto">
  <name>Task 2: Rewrite init.lua as thin bootstrap and create plugin specs</name>
  <files>
    dotfiles/nvim/init.lua
    dotfiles/nvim/lua/plugins/colorscheme.lua
    dotfiles/nvim/lua/plugins/treesitter.lua
  </files>
  <action>
    **dotfiles/nvim/init.lua**
    Replace the entire file. The new init.lua must be 20–25 lines maximum. No options, no keymaps, no colorscheme code:

    ```lua
    -- Leader must be set before lazy.nvim loads plugins
    vim.g.mapleader = " "
    vim.g.maplocalleader = " "

    -- Core config: no plugin dependencies
    require("config.options")
    require("config.keymaps")
    require("config.autocmds")

    -- Bootstrap lazy.nvim
    local lazypath = vim.fn.stdpath("data") .. "/lazy/lazy.nvim"
    if not vim.loop.fs_stat(lazypath) then
      vim.fn.system({
        "git", "clone", "--filter=blob:none",
        "https://github.com/folke/lazy.nvim.git",
        "--branch=stable",
        lazypath,
      })
    end
    vim.opt.rtp:prepend(lazypath)

    -- Load plugins from lua/plugins/ (auto-scanned by lazy.nvim)
    require("lazy").setup("plugins", {
      ui = { border = "rounded" },
      lockfile = vim.fn.stdpath("data") .. "/lazy-lock.json",
    })
    ```

    This replaces the entire existing init.lua. The hand-rolled colorscheme block (lines 41–74), the inline `require("lazy").setup({...})` with fzf.vim/telescope/commander specs, and all other content are removed.

    **dotfiles/nvim/lua/plugins/colorscheme.lua**
    Create this file exactly as specified in the research:

    ```lua
    -- Colorscheme: modus_vivendi_tinted with background matched to terminal
    -- lazy=false + priority=1000 ensures this loads before all other plugins
    return {
      "miikanissi/modus-themes.nvim",
      lazy = false,
      priority = 1000,
      config = function()
        require("modus-themes").setup({
          style = "modus_vivendi",
          variant = "tinted",
          styles = {
            comments = { italic = true },
            keywords = { italic = false },
          },
          on_colors = function(colors)
            -- Plugin default bg_main is #0d0e1c; override to match terminal bg
            colors.bg_main = "#1d2235"
          end,
        })
        vim.cmd("colorscheme modus_vivendi_tinted")
      end,
    }
    ```

    **dotfiles/nvim/lua/plugins/treesitter.lua**
    Create this file exactly as specified in the research. The `branch = "master"` line is REQUIRED — without it lazy.nvim pulls the new `main` branch which removed `require("nvim-treesitter.configs").setup()`:

    ```lua
    -- Treesitter: syntax highlighting, indentation, and incremental selection
    -- branch="master" is required — the new "main" branch removed ensure_installed
    -- event=BufReadPre/BufNewFile means 0ms startup cost; loads on first file open
    return {
      "nvim-treesitter/nvim-treesitter",
      branch = "master",
      build = ":TSUpdate",
      event = { "BufReadPre", "BufNewFile" },
      config = function()
        require("nvim-treesitter.configs").setup({
          ensure_installed = {
            "nix", "python", "typescript", "go", "rust", "c",
            "lua", "markdown", "json", "yaml", "toml", "bash",
          },
          auto_install = false,
          sync_install = false,
          highlight = { enable = true },
          indent = { enable = true },
          incremental_selection = {
            enable = true,
            keymaps = {
              init_selection = "<C-space>",
              node_incremental = "<C-space>",
              scope_incremental = false,
              node_decremental = "<bs>",
            },
          },
        })
      end,
    }
    ```
  </action>
  <verify>
    Verify init.lua is thin (no colorscheme, no plugin specs inline):
    ```bash
    wc -l /Users/sgoodluck/nix/dotfiles/nvim/init.lua
    ```
    Must be under 30 lines.

    ```bash
    grep -c "nvim_set_hl\|hi clear\|fzf\|telescope\|commander" /Users/sgoodluck/nix/dotfiles/nvim/init.lua
    ```
    Must return 0.

    Verify plugin files exist:
    ```bash
    ls /Users/sgoodluck/nix/dotfiles/nvim/lua/plugins/
    ```
    Must show: `colorscheme.lua  treesitter.lua`

    Verify treesitter has the critical branch pin:
    ```bash
    grep 'branch = "master"' /Users/sgoodluck/nix/dotfiles/nvim/lua/plugins/treesitter.lua
    ```
    Must return a match.
  </verify>
  <done>init.lua is under 30 lines with no inline plugin specs or colorscheme code. colorscheme.lua and treesitter.lua exist with the exact specs from the research. branch="master" is present in treesitter.lua.</done>
</task>

</tasks>

<verification>
After plan completion, verify the full file structure:
```bash
find /Users/sgoodluck/nix/dotfiles/nvim/lua -type f | sort
```
Expected output:
```
dotfiles/nvim/lua/config/autocmds.lua
dotfiles/nvim/lua/config/keymaps.lua
dotfiles/nvim/lua/config/options.lua
dotfiles/nvim/lua/plugins/colorscheme.lua
dotfiles/nvim/lua/plugins/treesitter.lua
```

Verify no plugin requires in config files:
```bash
grep -rn "require(" /Users/sgoodluck/nix/dotfiles/nvim/lua/config/
```
Must return no matches.
</verification>

<success_criteria>
The modular Neovim config structure is complete. init.lua is a thin bootstrap. Options/keymaps/autocmds are in lua/config/. modus-themes.nvim and nvim-treesitter specs exist in lua/plugins/. fzf.vim, telescope, plenary, and commander are gone. The config is ready for Neovim to open and install plugins on first launch.
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-02-SUMMARY.md`
</output>
