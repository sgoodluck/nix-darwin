---
phase: 01-foundation
plan: 03
type: execute
wave: 2
depends_on:
  - 01-01
  - 01-02
files_modified: []
autonomous: false
requirements:
  - FNDN-05

must_haves:
  truths:
    - "vim.fn.exepath(\"gopls\") returns a non-empty path inside a running Neovim session"
    - "All 6 primary LSP servers are visible on Neovim's PATH"
    - "Cold start measured via --startuptime is under 100ms"
    - "Neovim opens with modus_vivendi_tinted colorscheme, no flash of wrong colors"
    - "Treesitter highlights are active in Nix, Python, TypeScript, Go, Rust, and Lua files"
  artifacts:
    - path: "dotfiles/nvim/init.lua"
      provides: "Verified working bootstrap"
    - path: "dotfiles/nvim/lua/plugins/colorscheme.lua"
      provides: "Verified working colorscheme"
    - path: "dotfiles/nvim/lua/plugins/treesitter.lua"
      provides: "Verified working treesitter with all 12 parsers"
  key_links:
    - from: "Nix system packages"
      to: "Neovim PATH"
      via: "Shell profile propagation from darwin-rebuild"
      pattern: "exepath.*gopls"
---

<objective>
Verify that Neovim opens cleanly with the new modular config, all LSP server binaries are visible from inside Neovim, treesitter parsers are installed and highlighting, and cold start is under 100ms.

Purpose: FNDN-05. This is the phase gate — Phase 2 (LSP configuration) cannot start until PATH verification passes. Silent PATH failures cause LSP clients to never attach, with no useful error message.
Output: Confirmed passing phase acceptance criteria. Blockers identified if any checks fail.
</objective>

<execution_context>
@/Users/sgoodluck/.claude/get-shit-done/workflows/execute-plan.md
@/Users/sgoodluck/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-CONTEXT.md
@.planning/phases/01-foundation/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Run startup time measurement and prepare PATH verification script</name>
  <files></files>
  <action>
    Measure Neovim cold start time from the terminal. Run:

    ```bash
    nvim --startuptime /tmp/nvim-startup.log +q && tail -5 /tmp/nvim-startup.log
    ```

    The last line of the log shows total startup time in milliseconds. Target: under 100ms. Expected with only the colorscheme loading eagerly: 25-50ms.

    If the measurement is over 100ms, report the specific line in the startup log that is taking the most time. Do not proceed to the checkpoint until the measurement is taken and recorded.

    Also create the PATH verification diagnostic script that will be used in the checkpoint:

    ```bash
    cat > /tmp/check-nvim-path.lua << 'EOF'
    local servers = {
      "gopls",
      "pyright",
      "typescript-language-server",
      "lua-language-server",
      "nixd",
      "rust-analyzer",
      "ccls",
    }

    print("=== Neovim PATH check ===")
    print("PATH:", vim.env.PATH)
    print("")
    for _, server in ipairs(servers) do
      local path = vim.fn.exepath(server)
      local status = path ~= "" and "OK  " or "FAIL"
      print(string.format("[%s] %s", status, server))
    end
    EOF
    ```

    Note: `pyright` is not yet in packages.nix (it will be added in Phase 2 during the Python LSP decision). It is expected to FAIL at this point. The servers that MUST pass are: gopls, typescript-language-server, lua-language-server, nixd, rust-analyzer, ccls.
  </action>
  <verify>
    ```bash
    test -f /tmp/nvim-startup.log && echo "startup log exists" || echo "MISSING"
    test -f /tmp/check-nvim-path.lua && echo "path check script exists" || echo "MISSING"
    tail -3 /tmp/nvim-startup.log
    ```
    Both files must exist. The startup log must show a total time.
  </verify>
  <done>Startup time recorded. PATH verification script written to /tmp/check-nvim-path.lua. Startup time noted (pass/fail against 100ms target).</done>
</task>

<task type="checkpoint:human-verify">
  <name>Task 2: Verify Neovim opens correctly and PATH check passes</name>
  <files></files>
  <action>Human verification required — visual colorscheme match and interactive Neovim session cannot be automated.</action>
  <what-built>
    Modular Neovim config with modus-themes.nvim and nvim-treesitter. System rebuilt with lua-language-server, nixd, and rust-analyzer. Startup time measured. PATH verification script prepared.
  </what-built>
  <how-to-verify>
    **Step 1: Open Neovim and install plugins**

    On first launch, lazy.nvim will install modus-themes.nvim and nvim-treesitter. This may take 30-60 seconds.

    ```bash
    nvim
    ```

    Confirm:
    - The background is dark blue-grey (`#1d2235`) matching your terminal — not the very dark `#0d0e1c`
    - No error messages appear on startup
    - lazy.nvim shows the install progress (`:Lazy` to check status if needed)

    **Step 2: Verify treesitter parsers installed**

    Inside Neovim, run:
    ```
    :TSInstall nix python typescript go rust c lua markdown json yaml toml bash
    ```

    Wait for installation to complete, then check health:
    ```
    :checkhealth nvim-treesitter
    ```

    Confirm all 12 parsers show as OK (no red errors). Built-in parsers (vim, vimdoc, query) may show as "already bundled" — that is fine.

    **Step 3: Verify syntax highlighting**

    Open a Nix file:
    ```bash
    nvim ~/nix/flake.nix
    ```

    Confirm treesitter highlights are active (identifiers, strings, and keywords should have distinct colors from the modus palette, not just basic syntax colors).

    **Step 4: Run PATH verification inside Neovim**

    Inside Neovim:
    ```
    :luafile /tmp/check-nvim-path.lua
    ```

    **Required to pass** (these 6 were in packages.nix before this phase or added in Plan 01):
    - `[OK  ] gopls`
    - `[OK  ] typescript-language-server`
    - `[OK  ] lua-language-server`
    - `[OK  ] nixd`
    - `[OK  ] rust-analyzer`
    - `[OK  ] ccls`

    **Expected to fail** (not yet added, will be addressed in Phase 2):
    - `[FAIL] pyright`

    If any of the 6 required servers show FAIL, do NOT type "approved" — describe which servers failed.

    **Step 5: Confirm startup time**

    The startup log from Task 1 should show under 100ms on its last line.
  </how-to-verify>
  <verify>All 6 required LSP server exepath() checks return non-empty paths from inside Neovim. Startup time is under 100ms.</verify>
  <done>Neovim opens with modus_vivendi_tinted colorscheme matching terminal background. Treesitter highlights active. All 6 required LSP servers visible on PATH. Cold start under 100ms. Phase 1 complete.</done>
  <resume-signal>
    Type "approved" if all 6 required LSP servers pass PATH check, treesitter highlights are visible, background color matches terminal, and startup is under 100ms.

    Or describe any failures (e.g., "lua-language-server FAIL — rebuild may not have completed").
  </resume-signal>
</task>

</tasks>

<verification>
Phase 1 is complete when:
1. Startup time is under 100ms (target: 25-50ms)
2. All 6 required LSP servers return non-empty paths from vim.fn.exepath() inside Neovim
3. Treesitter shows active highlights in at least one Nix file
4. Neovim opens with modus_vivendi_tinted colorscheme, background #1d2235
5. No startup errors in Neovim
6. :checkhealth nvim-treesitter shows no red errors for the 12 target parsers
</verification>

<success_criteria>
Phase 1 foundation is verified:
- Modular structure: init.lua thin bootstrap, lua/config/, lua/plugins/
- Colorscheme: modus_vivendi_tinted with #1d2235 background
- Treesitter: all 12 parsers installed and highlighting
- PATH: gopls, typescript-language-server, lua-language-server, nixd, rust-analyzer, ccls all visible from inside Neovim
- Cold start: under 100ms
Phase 2 (LSP + Completion) is unblocked.
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-03-SUMMARY.md`
</output>
