#!/bin/bash

# Check if context argument is provided
if [ -z "$1" ]; then
  echo "Usage: $0 <kube-context>"
  echo "Example: $0 uat-pub"
  exit 1
fi

KUBE_CONTEXT=$1

# Switch to the specified context
echo "Switching to context: $KUBE_CONTEXT"
kubectx $KUBE_CONTEXT

# Switch to ion namespace
echo "Switching to namespace: ion"
kubens ion

# List pods
kubectl get pod

# Create a variable with the first running API pod
API_POD=$(kubectl get pod | grep "api" | grep "Running" | head -1 | awk '{print $1}')

if [ -z "$API_POD" ]; then
  echo "Error: No running API pod found"
  exit 1
fi

echo "First running API pod: $API_POD"

# exec into the running pod and pull out the SQLALCHEMY_DATABASE_URI and display it
echo "=== SQLALCHEMY_DATABASE_URI ==="
kubectl exec $API_POD -- grep "SQLALCHEMY_DATABASE_URI" /tmp/env | cut -d'"' -f2

exit
